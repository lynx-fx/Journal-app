@inherits LayoutComponentBase
@using JournalApp.Services
@inject IThemeService ThemeService

<div class="page">
    <main>
        <div class="content px-4">
            @Body
        </div>
    </main>
</div>

<div class="dynamic-island-container">
    <div class="dynamic-island">
        <NavLink class="nav-item" href="calendar" Match="NavLinkMatch.All">
            <span role="img" aria-label="Calendar">📅</span>
        </NavLink>
        <NavLink class="nav-item" href="/" Match="NavLinkMatch.All">
            <span role="img" aria-label="Today">📝</span>
        </NavLink>
        <button class="nav-item theme-toggle-btn" @onclick="ToggleTheme">
            <span role="img" aria-label="Theme">@(IsDark ? "☀️" : "🌙")</span>
        </button>
    </div>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>



@code {
    private bool IsDark;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                await ThemeService.InitializeTheme();
                IsDark = await ThemeService.IsDarkMode();
                StateHasChanged();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error initializing theme: {ex.Message}");
            }
        }
    }

    private async Task ToggleTheme()
    {
        await ThemeService.ToggleTheme();
        IsDark = await ThemeService.IsDarkMode();
    }
}
